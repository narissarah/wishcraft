# Railway Deployment Checklist for WishCraft

## Critical Environment Variables Required on Railway

You must set these environment variables in your Railway project settings:

### 1. **SHOPIFY_API_KEY** (Required)
- Value: `ac161e228a6b078fcdd3fa14586ded14` (from your .env.wishcraft)
- Found in: Shopify Partner Dashboard > Apps > WishCraft > API credentials

### 2. **SHOPIFY_API_SECRET** (Required)
- Value: Get from Shopify Partner Dashboard
- Found in: Shopify Partner Dashboard > Apps > WishCraft > API credentials

### 3. **DATABASE_URL** (Required)
- Railway should auto-generate this when you add a PostgreSQL service
- Format: `postgresql://user:password@host:5432/dbname`

### 4. **SESSION_SECRET** (Required)
- Generate a secure random string (at least 32 characters)
- You can generate one with: `openssl rand -hex 32`

### 5. **SHOPIFY_APP_URL** (Required)
- Value: `https://wishcraft-production.up.railway.app`
- This must match your Railway deployment URL

### 6. **SHOPIFY_SCOPES** (Optional - has defaults)
- Default: `read_customers,read_orders,write_orders,read_products,read_inventory,write_metaobjects`

## Steps to Fix Railway Deployment

1. **Go to Railway Dashboard**
   - Navigate to your WishCraft project
   - Click on "Variables" tab

2. **Add Required Environment Variables**
   ```
   SHOPIFY_API_KEY=ac161e228a6b078fcdd3fa14586ded14
   SHOPIFY_API_SECRET=[get from Shopify Partner Dashboard]
   DATABASE_URL=[auto-generated by Railway PostgreSQL]
   SESSION_SECRET=[generate with: openssl rand -hex 32]
   SHOPIFY_APP_URL=https://wishcraft-production.up.railway.app
   NODE_ENV=production
   PORT=3000
   ```

3. **Ensure PostgreSQL Service is Added**
   - In Railway, click "New" > "Database" > "Add PostgreSQL"
   - Railway will automatically inject DATABASE_URL

4. **Verify Deployment Settings**
   - Check that Railway is now using Docker (not Nixpacks)
   - The new railway.json file should enforce this

5. **Trigger Redeployment**
   - After setting all environment variables
   - Click "Deploy" or push new commits

## What We Fixed

1. **Railway Configuration**
   - Changed from Nixpacks to Docker builder
   - Added explicit railway.json configuration

2. **Security Headers**
   - Removed restrictive CSP that was breaking Shopify embedded apps
   - Now only sets minimal frame-ancestors for embedded context

3. **Environment Variables**
   - Created .env.example template
   - Documented all required variables

## Verification Steps

Once deployed, verify:

1. **Health Check**: Visit `https://wishcraft-production.up.railway.app/health`
2. **Shopify OAuth**: Try installing the app from Shopify Partner Dashboard
3. **Embedded View**: Ensure app loads correctly within Shopify Admin

## Common Issues

- **"Missing required environment variables"**: Check all variables above are set
- **"Database connection failed"**: Ensure PostgreSQL service is added and DATABASE_URL is set
- **"CSP errors in console"**: The latest changes should fix this
- **"App won't load in Shopify"**: Check SHOPIFY_APP_URL matches your Railway URL exactly

## Need Help?

If deployment still fails after following this checklist:
1. Check Railway deployment logs for specific errors
2. Ensure your Shopify app settings match the Railway URL
3. Verify all environment variables are correctly set